#!/home/pipeline/.conda/envs/pipeline/bin/python

import argparse
import sys
import signal

from gppy.run import run_scidata_reduction


def signal_handler(sig, frame):
    print("\nTerminate process")
    sys.exit(0)


signal.signal(signal.SIGINT, signal_handler)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(
        description=(
            "Reduce astronomical FITS images by performing astrometry, photometry, "
            "image stacking, and image subtraction. Supports various processing steps "
            "and optional overwrite functionality."
        )
    )
    parser.add_argument("-config", type=str, required=True, help="Path to the preprocessing configuration file")
    parser.add_argument("-processes", nargs="+", required=False, help="Processes to run")
    parser.add_argument("-overwrite", action="store_true", help="Overwrite existing results")
    parser.add_argument("-is_too", action="store_true", help="Use TOO processing")
    args = parser.parse_args()

    try:
        run_scidata_reduction(args.config, processes=args.processes, overwrite=args.overwrite, is_too=args.is_too)
    except Exception as e:
        print(f"\nError: {e}")
        sys.exit(1)
