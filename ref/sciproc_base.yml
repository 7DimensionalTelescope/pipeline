# This is the base configuration for the daily processing with daily stacks
# Also user-inputs use this by default

name: 

process_id:

# obs:
#   # OBS Info should be updated from header
#   coherent_input:
#   pixscale: 0.505  # arcsec/pix
#   n_binning: 
#   gain: 
#   unit: 
#   camera: 
#   filter:
#   obj:
#   nightdate:  # date of datetime - 12h. dirname of obsdata
#   obstime:  # UTC
#   ra:
#   dec:
#   exptime:

input: 
  calibrated_images: 
  processed_dir:
  coadd_image:
  difference_image:

flag:
  # configuration: false
  # preprocess: false
  astrometry: false
  single_photometry: false
  coadd: false
  # joint_astrometry: false
  coadd_photometry: false
  subtraction: false
  difference_photometry: false

qa:
  pa:
  ellipticity:
  seeing:

info:
  file:
  project: 7DT/7DS
  creation_version:
  runtime_version:
  creation_datetime:
  last_update_datetime:

settings:
  is_too: false
  is_pipeline: false  # default false, true if found to be is_pipeline
  obsmode:  # Deep Spec Color Search Single
  coadd: True
  gpu_enabled: True
  verbose_gpu: True  # use logger later
  
logging:
  level: INFO
  file: 
  format: '[%(levelname)s] %(asctime)s - %(name)s - %(message)s'
  handlers:
    - console
    - file

astrometry:
  input_images:
  eval_match_radius: 5.0  # 10.0  # arcsec
  path:
    ref_ris_dir: "/lyman/data1/factory/catalog/gaia_dr3_7DT"
    ref_query_dir: "/lyman/data1/factory/ref_scamp"
  ahead_file: "/data/pipeline_reform/dhhyun_lab/scamptest/ahead/calib_7DT11_T07304_20250115_050155_g_60_nocrval.ahead"
  local_astref: 
  scamp_timeout: 60  #30  # seconds
  solvefield_timeout: 60  # seconds

photometry:
  input_images:
  path:  # can be specified manually
    ref_cat:  # for RIS tiles
    ref_gaia_dir:  # raw Gaia catalog directory
  query_radius: 1.0  # deg
  match_radius: 1.0  # arcsec
  photfraction: 0.75
  refcatname: GaiaXP
  refqueryradius: 0.9
  ref_mag_lower: 12
  ref_mag_upper: 17.5
  ref_mag_err_upper: 0.05
  flagcut: 0
  check: False
  filters_to_check:
  satur_margin: 0.99  # factor multiplied to the propagated hardware upper limit
  sex_vars:
    PHOT_APERTURES:
    PHOT_AUTOPARAMS:
    DETECT_MINAREA: 5
    DETECT_THRESH: 3.0
    DEBLEND_NTHRESH: 64
    DEBLEND_MINCONT: 0.0001
    BACK_SIZE: 64
    BACK_FILTERSIZE: 3
    BACKPHOTO_TYPE: LOCAL

imcoadd:
  input_images:
  # path:
  #   ref_image_dir: "/lyman/data1/factory/ref_frame"
  coadd_image:  # output coadd image
  gpu: True
  device: 0
  zp_key: 'ZP_AUTO'
  # images_to_combine:
  bkgsub_type: 'Dynamic'
  weight_map: true
  joint_wcs: False
  apply_bpmask: False
  interp_type: 'median'
  convolve: 
  target_seeing:  # auto if it's empty or smaller than max seeing
  propagate_mask: False

imsubtract:
  input_image:
  reference_image:
  # input_mask:
  # template_mask: